<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Log</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, sans-serif; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script>
const { useState, useEffect } = React;

// ===== CONFIGURE YOUR API URL HERE =====
const API_URL = window.location.hostname === 'localhost' 
  ? 'http://localhost:3001/api'
  : 'https://order-log-backend.onrender.com/api';  // <-- Change this after deploying backend
// ========================================

// API helper
const api = {
  token: localStorage.getItem('token'),
  
  setToken(t) { this.token = t; localStorage.setItem('token', t); },
  clearToken() { this.token = null; localStorage.removeItem('token'); },
  
  async request(method, path, body) {
    const opts = {
      method,
      headers: { 'Content-Type': 'application/json' }
    };
    if (this.token) opts.headers['Authorization'] = 'Bearer ' + this.token;
    if (body) opts.body = JSON.stringify(body);
    
    const res = await fetch(API_URL + path, opts);
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Request failed');
    return data;
  },
  
  get(path) { return this.request('GET', path); },
  post(path, body) { return this.request('POST', path, body); },
  put(path, body) { return this.request('PUT', path, body); },
  del(path) { return this.request('DELETE', path); }
};

const formatCurrency = (n) => '$' + Number(n).toFixed(2);
const formatDate = (d) => new Date(d).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
const COLORS = ['White', 'Blue', 'Red', 'Green', 'Yellow', 'Black', 'Orange', 'Purple'];

function App() {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [view, setView] = useState('orders');
  const [orders, setOrders] = useState([]);
  const [cleaners, setCleaners] = useState([]);
  const [extras, setExtras] = useState([]);
  const [settings, setSettings] = useState({ sameDayMult: 1.0, defaultRate: 2.0 });
  const [toast, setToast] = useState('');

  // Check existing token on load
  useEffect(() => {
    if (api.token) {
      api.get('/me')
        .then(data => { setUser(data.user); loadData(); })
        .catch(() => { api.clearToken(); setLoading(false); });
    } else {
      setLoading(false);
    }
  }, []);

  const loadData = async () => {
    try {
      const [o, c, e, s] = await Promise.all([
        api.get('/orders'),
        api.get('/cleaners'),
        api.get('/extras'),
        api.get('/settings')
      ]);
      setOrders(o);
      setCleaners(c);
      setExtras(e);
      setSettings(s);
    } catch (err) {
      console.error('Load data error:', err);
    }
    setLoading(false);
  };

  const handleLogin = async (username, password) => {
    const data = await api.post('/login', { username, password });
    api.setToken(data.token);
    setUser(data.user);
    await loadData();
  };

  const handleLogout = () => {
    api.clearToken();
    setUser(null);
    setOrders([]);
  };

  const notify = (msg) => { setToast(msg); setTimeout(() => setToast(''), 2000); };

  if (loading) {
    return React.createElement('div', { style: { minHeight: '100vh', background: '#0f172a', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#fff' } }, 'Loading...');
  }

  if (!user) {
    return React.createElement(Login, { onLogin: handleLogin });
  }

  const isAdmin = user.role === 'admin';
  const tabs = isAdmin ? ['orders', 'cleaners', 'extras', 'invoices', 'settings'] : ['orders'];

  return React.createElement('div', { style: { minHeight: '100vh', background: '#0f172a', color: '#e2e8f0', fontFamily: 'system-ui' } },
    React.createElement('div', { style: { background: 'linear-gradient(90deg, #1e40af, #7c3aed)', padding: '16px 20px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' } },
      React.createElement('div', { style: { fontWeight: 'bold', fontSize: '20px' } }, 'Order Log'),
      React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '12px' } },
        React.createElement('span', { style: { fontSize: '14px' } }, isAdmin ? 'ðŸ‘¤ Admin' : 'ðŸ“‹ Attendant'),
        React.createElement('button', { onClick: handleLogout, style: { background: 'rgba(255,255,255,0.2)', border: 'none', color: '#fff', padding: '6px 12px', borderRadius: '6px', cursor: 'pointer' } }, 'Logout')
      )
    ),
    React.createElement('div', { style: { background: '#1e293b', padding: '8px 16px', display: 'flex', gap: '8px', borderBottom: '1px solid #334155', flexWrap: 'wrap' } },
      tabs.map(t => React.createElement('button', { key: t, onClick: () => setView(t), style: { padding: '10px 16px', borderRadius: '8px', border: 'none', cursor: 'pointer', background: view === t ? 'linear-gradient(90deg, #3b82f6, #8b5cf6)' : 'transparent', color: view === t ? '#fff' : '#94a3b8', fontWeight: '500', textTransform: 'capitalize' } }, t))
    ),
    toast && React.createElement('div', { style: { position: 'fixed', top: 20, right: 20, background: '#065f46', color: '#fff', padding: '12px 20px', borderRadius: '8px', zIndex: 999 } }, toast),
    React.createElement('div', { style: { maxWidth: '900px', margin: '0 auto', padding: '20px' } },
      view === 'orders' && React.createElement(Orders, { orders, setOrders, cleaners, extras, settings, notify, loadData }),
      view === 'cleaners' && isAdmin && React.createElement(Cleaners, { cleaners, setCleaners, notify, loadData }),
      view === 'extras' && isAdmin && React.createElement(Extras, { extras, setExtras, notify, loadData }),
      view === 'invoices' && isAdmin && React.createElement(Invoices, { cleaners, extras, settings }),
      view === 'settings' && isAdmin && React.createElement(Settings, { settings, setSettings, notify })
    )
  );
}

function Login({ onLogin }) {
  const [name, setName] = useState('');
  const [pw, setPw] = useState('');
  const [err, setErr] = useState('');
  const [loading, setLoading] = useState(false);

  const submit = async (e) => {
    e.preventDefault();
    setErr('');
    setLoading(true);
    try {
      await onLogin(name, pw);
    } catch (err) {
      setErr(err.message || 'Login failed');
    }
    setLoading(false);
  };

  return React.createElement('div', { style: { minHeight: '100vh', background: '#0f172a', display: 'flex', alignItems: 'center', justifyContent: 'center', fontFamily: 'system-ui', padding: '20px' } },
    React.createElement('div', { style: { background: '#1e293b', padding: '40px', borderRadius: '16px', width: '100%', maxWidth: '360px', border: '1px solid #334155' } },
      React.createElement('h1', { style: { color: '#fff', textAlign: 'center', marginBottom: '24px', fontSize: '28px' } }, 'Order Log'),
      React.createElement('form', { onSubmit: submit },
        err && React.createElement('div', { style: { background: '#991b1b', color: '#fff', padding: '10px', borderRadius: '8px', marginBottom: '16px', textAlign: 'center' } }, err),
        React.createElement('div', { style: { marginBottom: '16px' } },
          React.createElement('label', { style: lbl }, 'Username'),
          React.createElement('input', { value: name, onChange: e => setName(e.target.value), style: inp, disabled: loading })
        ),
        React.createElement('div', { style: { marginBottom: '20px' } },
          React.createElement('label', { style: lbl }, 'Password'),
          React.createElement('input', { type: 'password', value: pw, onChange: e => setPw(e.target.value), style: inp, disabled: loading })
        ),
        React.createElement('button', { type: 'submit', disabled: loading, style: { ...btn, width: '100%', padding: '14px', fontSize: '16px', opacity: loading ? 0.6 : 1 } }, loading ? 'Signing in...' : 'Sign In')
      )
    )
  );
}

function Orders({ orders, setOrders, cleaners, extras, settings, notify, loadData }) {
  const [showForm, setShowForm] = useState(false);
  const [editing, setEditing] = useState(null);
  const [search, setSearch] = useState('');

  const filtered = orders.filter(o => 
    o.order_num.includes(search) || 
    (cleaners.find(c => c.id === o.cleaner_id)?.name || '').toLowerCase().includes(search.toLowerCase())
  );

  const saveOrder = async (data) => {
    try {
      if (editing) {
        await api.put('/orders/' + data.id, data);
        notify('Order updated');
      } else {
        await api.post('/orders', data);
        notify('Order added');
      }
      await loadData();
      setShowForm(false);
      setEditing(null);
    } catch (err) {
      alert(err.message);
    }
  };

  const deleteOrder = async (id) => {
    if (!window.confirm('Delete this order?')) return;
    try {
      await api.del('/orders/' + id);
      notify('Deleted');
      await loadData();
    } catch (err) {
      alert(err.message);
    }
  };

  return React.createElement('div', null,
    React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px', flexWrap: 'wrap', gap: '12px' } },
      React.createElement('h2', { style: { margin: 0, fontSize: '22px' } }, 'Orders'),
      React.createElement('button', { onClick: () => { setEditing(null); setShowForm(true); }, style: btn }, '+ New Order')
    ),
    cleaners.length === 0 ?
      React.createElement('div', { style: { textAlign: 'center', padding: '40px', color: '#64748b' } }, 'âš ï¸ No cleaners set up. Ask admin to add cleaner locations first.') :
      React.createElement(React.Fragment, null,
        React.createElement('input', { placeholder: 'Search by order # or cleaner...', value: search, onChange: e => setSearch(e.target.value), style: { ...inp, marginBottom: '16px' } }),
        filtered.length === 0 ?
          React.createElement('div', { style: { textAlign: 'center', padding: '40px', color: '#64748b' } }, 'No orders found.') :
          filtered.slice(0, 100).map(o => React.createElement('div', { key: o.id, style: { background: '#1e293b', borderRadius: '12px', padding: '16px', marginBottom: '12px', border: '1px solid #334155' } },
            React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', marginBottom: '8px' } },
              React.createElement('div', null,
                React.createElement('span', { style: { fontWeight: 'bold', marginRight: '10px' } }, '#' + o.order_num),
                React.createElement('span', { style: { background: o.service_type === 'same-day' ? '#f59e0b' : '#3b82f6', padding: '3px 10px', borderRadius: '10px', fontSize: '11px', fontWeight: 'bold' } }, o.service_type === 'same-day' ? 'Same Day' : '24 Hour')
              )
            ),
            React.createElement('div', { style: { fontWeight: '500', marginBottom: '6px' } }, cleaners.find(c => c.id === o.cleaner_id)?.name || 'Unknown'),
            React.createElement('div', { style: { color: '#94a3b8', fontSize: '13px', display: 'flex', gap: '16px', flexWrap: 'wrap' } },
              React.createElement('span', null, 'âš–ï¸ ' + o.weight + ' lbs'),
              React.createElement('span', null, 'ðŸ“… ' + formatDate(o.pickup_date)),
              React.createElement('span', null, 'ðŸŽ¨ ' + o.bag_color)
            ),
            o.extras?.length > 0 && React.createElement('div', { style: { marginTop: '8px', display: 'flex', gap: '6px', flexWrap: 'wrap' } },
              o.extras.map(id => React.createElement('span', { key: id, style: { background: '#334155', padding: '4px 8px', borderRadius: '6px', fontSize: '12px' } }, extras.find(e => e.id === id)?.name))
            ),
            React.createElement('div', { style: { display: 'flex', gap: '8px', marginTop: '12px', paddingTop: '12px', borderTop: '1px solid #334155' } },
              React.createElement('button', { onClick: () => { setEditing(o); setShowForm(true); }, style: editBtn }, 'Edit'),
              React.createElement('button', { onClick: () => deleteOrder(o.id), style: delBtn }, 'Delete')
            )
          ))
      ),
    showForm && React.createElement(OrderForm, { order: editing, cleaners, extras, settings, allOrders: orders, onSave: saveOrder, onClose: () => { setShowForm(false); setEditing(null); } })
  );
}

function OrderForm({ order, cleaners, extras, allOrders, onSave, onClose }) {
  const [data, setData] = useState({
    order_num: order?.order_num || '',
    weight: order?.weight || '',
    service_type: order?.service_type || '24-hour',
    pickup_date: order?.pickup_date?.split('T')[0] || new Date().toISOString().split('T')[0],
    bag_color: order?.bag_color || 'White',
    cleaner_id: order?.cleaner_id || '',
    extras: order?.extras || [],
    notes: order?.notes || '',
    id: order?.id || null,
  });
  const [saving, setSaving] = useState(false);

  const warnings = [];
  if (data.weight > 100) warnings.push('Weight ' + data.weight + ' lbs seems high!');
  if (data.order_num && data.cleaner_id) {
    const num = parseInt(data.order_num.replace(/\D/g, ''));
    const prev = allOrders.filter(o => o.cleaner_id === data.cleaner_id && o.id !== data.id).map(o => parseInt(o.order_num.replace(/\D/g, ''))).filter(n => !isNaN(n)).sort((a,b) => b-a);
    if (prev.length && Math.abs(num - prev[0]) > 25) warnings.push('Order # is ' + Math.abs(num - prev[0]) + ' away from last (#' + prev[0] + ')');
  }

  const submit = async (e) => {
    e.preventDefault();
    if (!data.order_num || !data.weight || !data.cleaner_id) { alert('Fill required fields'); return; }
    if (warnings.length && !window.confirm(warnings.join('\n') + '\n\nSave anyway?')) return;
    setSaving(true);
    await onSave(data);
    setSaving(false);
  };

  const toggle = (id) => {
    const numId = typeof id === 'string' ? parseInt(id) : id;
    setData({ ...data, extras: data.extras.includes(numId) ? data.extras.filter(x => x !== numId) : [...data.extras, numId] });
  };

  return React.createElement('div', { style: modal },
    React.createElement('div', { style: { background: '#1e293b', borderRadius: '12px', width: '100%', maxWidth: '500px', maxHeight: '90vh', overflow: 'auto', border: '1px solid #334155' } },
      React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', padding: '16px', borderBottom: '1px solid #334155' } },
        React.createElement('h3', { style: { margin: 0 } }, (order ? 'Edit' : 'New') + ' Order'),
        React.createElement('button', { onClick: onClose, style: { background: 'none', border: 'none', color: '#94a3b8', fontSize: '24px', cursor: 'pointer' } }, 'Ã—')
      ),
      React.createElement('form', { onSubmit: submit, style: { padding: '16px' } },
        warnings.length > 0 && warnings.map((w, i) => React.createElement('div', { key: i, style: { background: '#78350f', border: '1px solid #f59e0b', color: '#fef3c7', padding: '10px', borderRadius: '8px', marginBottom: '12px', fontSize: '14px' } }, 'âš ï¸ ' + w)),
        React.createElement('div', { style: { display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' } },
          React.createElement('div', null, React.createElement('label', { style: lbl }, 'Order # *'), React.createElement('input', { value: data.order_num, onChange: e => setData({...data, order_num: e.target.value}), style: inp })),
          React.createElement('div', null, React.createElement('label', { style: lbl }, 'Cleaner *'), React.createElement('select', { value: data.cleaner_id, onChange: e => setData({...data, cleaner_id: parseInt(e.target.value)}), style: inp }, React.createElement('option', { value: '' }, 'Select...'), cleaners.map(c => React.createElement('option', { key: c.id, value: c.id }, c.name)))),
          React.createElement('div', null, React.createElement('label', { style: lbl }, 'Weight (lbs) *'), React.createElement('input', { type: 'number', step: '0.1', value: data.weight, onChange: e => setData({...data, weight: parseFloat(e.target.value) || ''}), style: inp })),
          React.createElement('div', null, React.createElement('label', { style: lbl }, 'Service'), React.createElement('select', { value: data.service_type, onChange: e => setData({...data, service_type: e.target.value}), style: inp }, React.createElement('option', { value: '24-hour' }, '24 Hour'), React.createElement('option', { value: 'same-day' }, 'Same Day'))),
          React.createElement('div', null, React.createElement('label', { style: lbl }, 'Pickup Date'), React.createElement('input', { type: 'date', value: data.pickup_date, onChange: e => setData({...data, pickup_date: e.target.value}), style: inp })),
          React.createElement('div', null, React.createElement('label', { style: lbl }, 'Bag Color'), React.createElement('select', { value: data.bag_color, onChange: e => setData({...data, bag_color: e.target.value}), style: inp }, COLORS.map(c => React.createElement('option', { key: c }, c))))
        ),
        React.createElement('div', { style: { marginTop: '16px' } },
          React.createElement('label', { style: lbl }, 'Extras'),
          React.createElement('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '6px' } },
            extras.map(ex => React.createElement('div', { key: ex.id, onClick: () => toggle(ex.id), style: { padding: '8px', borderRadius: '6px', cursor: 'pointer', fontSize: '12px', textAlign: 'center', border: data.extras.includes(ex.id) ? '2px solid #3b82f6' : '1px solid #475569', background: data.extras.includes(ex.id) ? 'rgba(59,130,246,0.2)' : '#0f172a' } }, ex.name))
          )
        ),
        React.createElement('div', { style: { display: 'flex', gap: '12px', justifyContent: 'flex-end', marginTop: '20px', paddingTop: '16px', borderTop: '1px solid #334155' } },
          React.createElement('button', { type: 'button', onClick: onClose, style: cancelBtn }, 'Cancel'),
          React.createElement('button', { type: 'submit', disabled: saving, style: { ...submitBtn, opacity: saving ? 0.6 : 1 } }, saving ? 'Saving...' : (order ? 'Update' : 'Add'))
        )
      )
    )
  );
}

function Cleaners({ cleaners, setCleaners, notify, loadData }) {
  const [showForm, setShowForm] = useState(false);
  const [editing, setEditing] = useState(null);
  const [form, setForm] = useState({ name: '', rate: '', route: 'east' });

  const save = async (e) => {
    e.preventDefault();
    if (!form.name || !form.rate) { alert('Fill name and rate'); return; }
    try {
      if (editing) {
        await api.put('/cleaners/' + editing.id, form);
      } else {
        await api.post('/cleaners', form);
      }
      notify(editing ? 'Updated' : 'Added');
      await loadData();
      setShowForm(false); setEditing(null); setForm({ name: '', rate: '', route: 'east' });
    } catch (err) {
      alert(err.message);
    }
  };

  const del = async (id) => {
    if (!window.confirm('Delete this cleaner?')) return;
    try {
      await api.del('/cleaners/' + id);
      notify('Deleted');
      await loadData();
    } catch (err) {
      alert(err.message);
    }
  };

  return React.createElement('div', null,
    React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', marginBottom: '20px' } },
      React.createElement('h2', { style: { margin: 0 } }, 'Cleaner Locations'),
      React.createElement('button', { onClick: () => { setEditing(null); setForm({ name: '', rate: '', route: 'east' }); setShowForm(true); }, style: btn }, '+ Add Cleaner')
    ),
    React.createElement('div', { style: { display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(260px, 1fr))', gap: '12px' } },
      cleaners.map(c => React.createElement('div', { key: c.id, style: { background: '#1e293b', padding: '16px', borderRadius: '12px', border: '1px solid #334155' } },
        React.createElement('div', { style: { fontWeight: 'bold', marginBottom: '4px' } }, c.name),
        React.createElement('div', { style: { fontSize: '24px', color: '#4ade80', fontWeight: 'bold' } }, formatCurrency(c.rate) + '/lb'),
        React.createElement('div', { style: { display: 'inline-block', padding: '4px 12px', borderRadius: '6px', fontSize: '12px', fontWeight: 'bold', marginTop: '8px', background: c.route === 'east' ? '#3b82f6' : '#f59e0b' } }, c.route === 'east' ? 'ðŸ—½ East' : 'ðŸŒ† West'),
        React.createElement('div', { style: { display: 'flex', gap: '8px', marginTop: '12px' } },
          React.createElement('button', { onClick: () => { setEditing(c); setForm({ name: c.name, rate: c.rate, route: c.route }); setShowForm(true); }, style: editBtn }, 'Edit'),
          React.createElement('button', { onClick: () => del(c.id), style: delBtn }, 'Delete')
        )
      ))
    ),
    showForm && React.createElement('div', { style: modal },
      React.createElement('div', { style: { background: '#1e293b', borderRadius: '12px', width: '100%', maxWidth: '400px', border: '1px solid #334155' } },
        React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', padding: '16px', borderBottom: '1px solid #334155' } },
          React.createElement('h3', { style: { margin: 0 } }, (editing ? 'Edit' : 'Add') + ' Cleaner'),
          React.createElement('button', { onClick: () => setShowForm(false), style: { background: 'none', border: 'none', color: '#94a3b8', fontSize: '24px', cursor: 'pointer' } }, 'Ã—')
        ),
        React.createElement('form', { onSubmit: save, style: { padding: '16px' } },
          React.createElement('div', { style: { marginBottom: '12px' } }, React.createElement('label', { style: lbl }, 'Name *'), React.createElement('input', { value: form.name, onChange: e => setForm({...form, name: e.target.value}), style: inp })),
          React.createElement('div', { style: { marginBottom: '12px' } }, React.createElement('label', { style: lbl }, 'Rate/lb *'), React.createElement('input', { type: 'number', step: '0.01', value: form.rate, onChange: e => setForm({...form, rate: parseFloat(e.target.value)}), style: inp })),
          React.createElement('div', { style: { marginBottom: '12px' } }, React.createElement('label', { style: lbl }, 'Route *'), React.createElement('select', { value: form.route, onChange: e => setForm({...form, route: e.target.value}), style: inp }, React.createElement('option', { value: 'east' }, 'East Side'), React.createElement('option', { value: 'west' }, 'West Side'))),
          React.createElement('div', { style: { display: 'flex', gap: '12px', justifyContent: 'flex-end' } },
            React.createElement('button', { type: 'button', onClick: () => setShowForm(false), style: cancelBtn }, 'Cancel'),
            React.createElement('button', { type: 'submit', style: submitBtn }, editing ? 'Update' : 'Add')
          )
        )
      )
    )
  );
}

function Extras({ extras, setExtras, notify, loadData }) {
  const [showForm, setShowForm] = useState(false);
  const [editing, setEditing] = useState(null);
  const [form, setForm] = useState({ name: '', price: '' });

  const save = async (e) => {
    e.preventDefault();
    if (!form.name || form.price === '') { alert('Fill name and price'); return; }
    try {
      if (editing) {
        await api.put('/extras/' + editing.id, form);
      } else {
        await api.post('/extras', form);
      }
      notify(editing ? 'Updated' : 'Added');
      await loadData();
      setShowForm(false); setEditing(null); setForm({ name: '', price: '' });
    } catch (err) {
      alert(err.message);
    }
  };

  return React.createElement('div', null,
    React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', marginBottom: '20px' } },
      React.createElement('h2', { style: { margin: 0 } }, 'Extra Items'),
      React.createElement('button', { onClick: () => { setEditing(null); setForm({ name: '', price: '' }); setShowForm(true); }, style: btn }, '+ Add Extra')
    ),
    extras.map(ex => React.createElement('div', { key: ex.id, style: { background: '#1e293b', padding: '12px 16px', borderRadius: '8px', marginBottom: '8px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', border: '1px solid #334155' } },
      React.createElement('span', null, ex.name),
      React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '16px' } },
        React.createElement('span', { style: { color: '#4ade80', fontWeight: 'bold' } }, formatCurrency(ex.price)),
        React.createElement('button', { onClick: () => { setEditing(ex); setForm({ name: ex.name, price: ex.price }); setShowForm(true); }, style: { ...editBtn, padding: '4px 10px', fontSize: '12px' } }, 'Edit'),
        React.createElement('button', { onClick: async () => { await api.del('/extras/' + ex.id); notify('Deleted'); await loadData(); }, style: { ...delBtn, padding: '4px 10px', fontSize: '12px' } }, 'Del')
      )
    )),
    showForm && React.createElement('div', { style: modal },
      React.createElement('div', { style: { background: '#1e293b', borderRadius: '12px', width: '100%', maxWidth: '350px', border: '1px solid #334155' } },
        React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', padding: '16px', borderBottom: '1px solid #334155' } },
          React.createElement('h3', { style: { margin: 0 } }, (editing ? 'Edit' : 'Add') + ' Extra'),
          React.createElement('button', { onClick: () => setShowForm(false), style: { background: 'none', border: 'none', color: '#94a3b8', fontSize: '24px', cursor: 'pointer' } }, 'Ã—')
        ),
        React.createElement('form', { onSubmit: save, style: { padding: '16px' } },
          React.createElement('div', { style: { marginBottom: '12px' } }, React.createElement('label', { style: lbl }, 'Name *'), React.createElement('input', { value: form.name, onChange: e => setForm({...form, name: e.target.value}), style: inp })),
          React.createElement('div', { style: { marginBottom: '12px' } }, React.createElement('label', { style: lbl }, 'Price *'), React.createElement('input', { type: 'number', step: '0.01', value: form.price, onChange: e => setForm({...form, price: parseFloat(e.target.value)}), style: inp })),
          React.createElement('div', { style: { display: 'flex', gap: '12px', justifyContent: 'flex-end' } },
            React.createElement('button', { type: 'button', onClick: () => setShowForm(false), style: cancelBtn }, 'Cancel'),
            React.createElement('button', { type: 'submit', style: submitBtn }, editing ? 'Update' : 'Add')
          )
        )
      )
    )
  );
}

function Invoices({ cleaners, extras, settings }) {
  const [cleanerId, setCleanerId] = useState('');
  const [start, setStart] = useState('');
  const [end, setEnd] = useState('');
  const [inv, setInv] = useState(null);
  const [loading, setLoading] = useState(false);

  const generate = async () => {
    if (!cleanerId || !start || !end) { alert('Select cleaner and dates'); return; }
    setLoading(true);
    try {
      const data = await api.get('/reports/invoice?cleaner_id=' + cleanerId + '&start_date=' + start + '&end_date=' + end);
      const cleaner = cleaners.find(c => c.id === parseInt(cleanerId));
      setInv({ cleaner: cleaner?.name || 'Unknown', start, end, orders: data.orders, total: data.grandTotal });
    } catch (err) {
      alert(err.message);
    }
    setLoading(false);
  };

  const setLastWeek = () => {
    const t = new Date(), s = new Date(t); s.setDate(t.getDate() - t.getDay() - 7);
    const e = new Date(s); e.setDate(s.getDate() + 6);
    setStart(s.toISOString().split('T')[0]); setEnd(e.toISOString().split('T')[0]);
  };

  return React.createElement('div', null,
    React.createElement('h2', null, 'Generate Invoice'),
    React.createElement('div', { style: { background: '#1e293b', padding: '16px', borderRadius: '12px', marginBottom: '20px', border: '1px solid #334155' } },
      React.createElement('div', { style: { display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '12px' } },
        React.createElement('div', null, React.createElement('label', { style: lbl }, 'Cleaner *'), React.createElement('select', { value: cleanerId, onChange: e => setCleanerId(e.target.value), style: inp }, React.createElement('option', { value: '' }, 'Select...'), cleaners.map(c => React.createElement('option', { key: c.id, value: c.id }, c.name)))),
        React.createElement('div', null, React.createElement('label', { style: lbl }, 'Quick'), React.createElement('button', { type: 'button', onClick: setLastWeek, style: { ...inp, cursor: 'pointer', textAlign: 'center' } }, 'Last Week')),
        React.createElement('div', null, React.createElement('label', { style: lbl }, 'Start *'), React.createElement('input', { type: 'date', value: start, onChange: e => setStart(e.target.value), style: inp })),
        React.createElement('div', null, React.createElement('label', { style: lbl }, 'End *'), React.createElement('input', { type: 'date', value: end, onChange: e => setEnd(e.target.value), style: inp }))
      ),
      React.createElement('button', { onClick: generate, disabled: loading, style: { ...btn, width: '100%', opacity: loading ? 0.6 : 1 } }, loading ? 'Generating...' : 'Generate Invoice')
    ),
    inv && React.createElement('div', { style: { background: '#fff', color: '#1e293b', padding: '24px', borderRadius: '12px' } },
      React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', borderBottom: '2px solid #e2e8f0', paddingBottom: '16px', marginBottom: '16px', flexWrap: 'wrap', gap: '12px' } },
        React.createElement('h2', { style: { color: '#1e40af', margin: 0 } }, 'INVOICE'),
        React.createElement('div', { style: { textAlign: 'right', fontSize: '14px', color: '#64748b' } },
          React.createElement('div', null, React.createElement('b', null, 'To:'), ' ', inv.cleaner),
          React.createElement('div', null, React.createElement('b', null, 'Period:'), ' ', formatDate(inv.start), ' - ', formatDate(inv.end))
        )
      ),
      inv.orders.length === 0 ? React.createElement('p', { style: { textAlign: 'center', color: '#64748b' } }, 'No orders found.') :
        React.createElement('table', { style: { width: '100%', borderCollapse: 'collapse' } },
          React.createElement('thead', null, React.createElement('tr', { style: { background: '#f1f5f9' } },
            React.createElement('th', { style: th }, 'Order #'),
            React.createElement('th', { style: th }, 'Date'),
            React.createElement('th', { style: th }, 'Weight'),
            React.createElement('th', { style: { ...th, textAlign: 'right' } }, 'Total')
          )),
          React.createElement('tbody', null, inv.orders.map(o => React.createElement('tr', { key: o.id },
            React.createElement('td', { style: td }, o.order_num),
            React.createElement('td', { style: td }, formatDate(o.pickup_date)),
            React.createElement('td', { style: td }, o.weight + ' lbs'),
            React.createElement('td', { style: { ...td, textAlign: 'right' } }, formatCurrency(o.total))
          ))),
          React.createElement('tfoot', null, React.createElement('tr', null,
            React.createElement('td', { colSpan: '3', style: { padding: '12px', textAlign: 'right', fontWeight: 'bold', borderTop: '2px solid #1e40af' } }, 'Grand Total'),
            React.createElement('td', { style: { padding: '12px', textAlign: 'right', fontWeight: 'bold', fontSize: '20px', color: '#1e40af', borderTop: '2px solid #1e40af' } }, formatCurrency(inv.total))
          ))
        )
    )
  );
}

function Settings({ settings, setSettings, notify }) {
  const [form, setForm] = useState(settings);
  const [saving, setSaving] = useState(false);
  
  const save = async (e) => { 
    e.preventDefault();
    setSaving(true);
    try {
      await api.put('/settings', { sameDayMult: parseFloat(form.sameDayMult), defaultRate: parseFloat(form.defaultRate) });
      setSettings(form);
      notify('Saved');
    } catch (err) {
      alert(err.message);
    }
    setSaving(false);
  };
  
  return React.createElement('div', null,
    React.createElement('h2', null, 'Settings'),
    React.createElement('form', { onSubmit: save, style: { background: '#1e293b', padding: '20px', borderRadius: '12px', maxWidth: '400px', border: '1px solid #334155' } },
      React.createElement('div', { style: { marginBottom: '12px' } }, React.createElement('label', { style: lbl }, 'Same-Day Multiplier'), React.createElement('input', { type: 'number', step: '0.1', value: form.sameDayMult, onChange: e => setForm({...form, sameDayMult: e.target.value}), style: inp })),
      React.createElement('p', { style: { color: '#64748b', fontSize: '12px', marginTop: '-8px', marginBottom: '16px' } }, '1.0 = no extra. 1.5 = 50% more.'),
      React.createElement('div', { style: { marginBottom: '16px' } }, React.createElement('label', { style: lbl }, 'Default Rate/lb'), React.createElement('input', { type: 'number', step: '0.01', value: form.defaultRate, onChange: e => setForm({...form, defaultRate: e.target.value}), style: inp })),
      React.createElement('button', { type: 'submit', disabled: saving, style: { ...btn, width: '100%', opacity: saving ? 0.6 : 1 } }, saving ? 'Saving...' : 'Save Settings')
    )
  );
}

// Styles
const lbl = { display: 'block', color: '#94a3b8', fontSize: '11px', marginBottom: '4px', textTransform: 'uppercase', fontWeight: '600' };
const inp = { width: '100%', padding: '10px', background: '#0f172a', border: '1px solid #475569', borderRadius: '6px', color: '#fff', fontSize: '14px', boxSizing: 'border-box' };
const btn = { background: 'linear-gradient(90deg, #3b82f6, #8b5cf6)', border: 'none', color: '#fff', padding: '10px 20px', borderRadius: '8px', fontWeight: 'bold', cursor: 'pointer' };
const cancelBtn = { padding: '10px 20px', border: '1px solid #475569', background: 'transparent', color: '#94a3b8', borderRadius: '8px', cursor: 'pointer' };
const submitBtn = { padding: '10px 20px', background: 'linear-gradient(90deg, #3b82f6, #8b5cf6)', border: 'none', color: '#fff', borderRadius: '8px', fontWeight: 'bold', cursor: 'pointer' };
const editBtn = { border: '1px solid #3b82f6', background: 'transparent', color: '#3b82f6', padding: '6px 12px', borderRadius: '6px', cursor: 'pointer' };
const delBtn = { border: '1px solid #ef4444', background: 'transparent', color: '#ef4444', padding: '6px 12px', borderRadius: '6px', cursor: 'pointer' };
const modal = { position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.8)', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '16px', zIndex: 100 };
const th = { textAlign: 'left', padding: '10px', fontSize: '11px', textTransform: 'uppercase', color: '#64748b' };
const td = { padding: '10px', borderBottom: '1px solid #e2e8f0' };

ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>
